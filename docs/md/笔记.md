[TOC]

# 前端

---

### 	vue3

- ##### 		ref数据赋值时需要`item.value = value` 否则会失去==响应式==



### Axios

- ##### post请求


​	请求前弹窗是否确认，确认后发送请求。

```js
batchRegister(selections) {
      const args = _.map(selections, (vo) => _.pick(vo, ['id', 'deviceId']))
      this.msg = []
      console.log(selections, 'selections')
      this.$confirm(`您确认要批量注册吗?`, '温馨提示', {
        confirmButtonText: '立即执行',
        cancelButtonText: '考虑一下',
        type: 'warning'
      }).then(() => {
        this.$post('url', args)
          .then(() => {
            this.$notify({
              title: '温馨提示',
              message: '注册成功',
              type: 'success'
            })
            this.dialogVisible = false
            this.crud.refresh()
          })
          .catch((error) => {
            this.dialogVisible = true
            this.msg = error.split('||')
            this.crud.refresh()
          })
      })
    },
```



### Element Plus	

- ##### 前后端传输date类型有时差，前端需要设置`value-format="YYYY-MM-DD"` ，后端在属性上加`@JsonFormat(pattern = "yyyy-MM-dd",timezone = "GMT+8")`即可解决。

```vue
<el-date-picker
            v-model="dataForm.birthday"
            type="date"
            placeholder="Pick a day"
            :size="'default'"
            value-format="YYYY-MM-DD"
        />
```



- ##### el-tree-v2 高度问题 ==:height设置自适应高度== `let defalutHeight = ref({})`

```vue
<div style="margin-right: 5px; height: 100%">
        <el-input v-model="query"
                  style="width: 240px; margin: 2px 2px 0 2px"
                  placeholder="Please enter keyword"
                  @input="onQueryChanged"/>
        <el-tree-v2
            ref="treeRef"
            style="width: 300px; max-width: 240px; max-height: 100vh;"
            icon=""
            :data="animeInfo"
            :props="{value:'id',label:'name'}"
            :filter-method="filter"
            :highlight-current="true"
            :height="defalutHeight"
            @node-click="clickNode"
        />
      </div>
<script>
    let defalutHeight = ref({})
	defalutHeight.value = document.documentElement.clientHeight - 300    
</script>
```



### CSS

- table内容过多时，省略

  ```css
  .text-over {
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
  }
  ```

  

---



# 后端

---

### 	mybatis-plus

- ##### 		可以使用mybatis-plus的方法，也可以编写xml文件进行查询。（避免混合使用，在查询后的数据再进行筛选不符合规范）




- ##### 查询省市区街道数据进行过滤分组


```sql
select a1.area_name '省', a2.area_name '市', a3.area_name '区', a4.area_name'街道', terminal_name,t.id from t_terminal t ,degal_upms.sys_area a1,degal_upms.sys_area a2, degal_upms.sys_area a3, degal_upms.sys_area a4
where t.province_code = a1.area_code
and t.city_code = a2.area_code 
AND t.district_code = a3.area_code
AND t.street_code = a4.area_code
and EXISTS(select 1 from ind_user_terminal_relation rel where rel.user_id='1862265294536613890' and t.id=rel.terminal_id)
group by a1.area_name,a2.area_name,a3.area_name,a4.area_name,t.terminal_name,t.id;
```

```sql
SELECT
        a1.area_name AS province,
        a2.area_name AS city,
        a3.area_name AS district,
        a4.area_name AS street,
        t.terminal_name AS terminalName,
        t.id AS id,
        CASE
          WHEN r.user_id IS NOT NULL THEN 1
          ELSE 0
          END AS is_commit
      FROM
        t_terminal t
          JOIN degal_upms.sys_area a1 ON t.province_code = a1.area_code
          JOIN degal_upms.sys_area a2 ON t.city_code = a2.area_code
          JOIN degal_upms.sys_area a3 ON t.district_code = a3.area_code
          JOIN degal_upms.sys_area a4 ON t.street_code = a4.area_code
          LEFT JOIN ind_user_terminal_relation r ON t.id = r.terminal_id AND r.user_id = ${userId}
      GROUP BY
        a1.area_name,
        a2.area_name,
        a3.area_name,
        a4.area_name,
        t.terminal_name,
        t.id,
        CASE
          WHEN r.user_id IS NOT NULL THEN 1
          ELSE 0
          END;
```



- ##### 使用page进行分页

```java
// 封装Page对象
Page<User> page = new Page<>(1, 10); // 第1页，每页显示10条记录

// 调用Mapper接口的分页查询方法
List<User> userList = userMapper.selectPage(page, null); // null表示没有额外的查询条件

// 处理分页查询结果
// userList包含了当前页的数据，page对象则包含了分页信息（如总记录数、总页数等）
```

- ##### 以上方法需要配置mybatis==拦截器==

```java
@Configuration
public class MyBatisPlusConfig {
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        // 添加分页插件
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL)); // 根据您的数据库类型选择DbType
        return interceptor;
    }
}
```

***将传入的 page参数的 pageSize设为 -1 即为查询全部数据***



- ##### 查询参数为Map<String xx, List<String> xx> 时如果要用foreach循环，collection="{对应的key}"



- ##### mabatis-plus更新不能传空值，可以使用`UpdateWapper`或者设置全局配置，再或者`@TableField(updateStrategy = FieldStrategy.IGNORED)`注解

  ```java
  UpdateWrapper<User> userUpdateWrapper = new UpdateWrapper<>();
      userUpdateWrapper.set("address", null);
      userUpdateWrapper.lambda().eq(User::getId, 1);
      userService.update(userUpdateWrapper);
  ```

  ```yml
  mybatis-plus:
    global-config:
      db-config:
        update-strategy: ignored
  ```




#### 根据name分批查询数据

```java
 private List<SysUserVO> selectLeaderByNames(List<String> leaderNameList) {
        final int BATCH_SIZE = 50; // 每批查询50个
        List<SysUserVO> result = new ArrayList<>();
        for (int i = 0; i < leaderNameList.size(); i += BATCH_SIZE) {
            int endIndex = Math.min(i + BATCH_SIZE, leaderNameList.size());

            List<String> batchNames = leaderNameList.subList(i, endIndex);
            String joinedNames = String.join(",", batchNames);
            List<SysUserVO> batchResult = sysUserService.search(
                    new SysUserQueryDTO().setLikeNames(joinedNames),
                    null,
                    null
            ).getList();
            if (!CollectionUtils.isEmpty(batchResult)) {
                result.addAll(batchResult);
            }
        }
        return result;
    }
```



---



### JAVA

- ##### 从网络URL中下载文件


```java
	/**
	 * 从网络Url中下载文件
	 * 
	 * @param urlStr
	 * @param fileName
	 * @param savePath
	 * @throws IOException
	 */
	public static String downLoadFromUrl(String urlStr, String fileName, String savePath) {
		try {
 
			URL url = new URL(urlStr);
			HttpURLConnection conn = (HttpURLConnection) url.openConnection();
			// 设置超时间为3秒
			conn.setConnectTimeout(3 * 1000);
			// 防止屏蔽程序抓取而返回403错误
			conn.setRequestProperty("User-Agent", "Mozilla/4.0 (compatible; MSIE 5.0; Windows NT; DigExt)");
 
			// 得到输入流
			InputStream inputStream = conn.getInputStream();
			// 获取自己数组
			byte[] getData = readInputStream(inputStream);
 
			// 文件保存位置
			File saveDir = new File(savePath);
			if (!saveDir.exists()) {
				saveDir.mkdir();
			}
			File file = new File(saveDir + File.separator + fileName);
			FileOutputStream fos = new FileOutputStream(file);
			fos.write(getData);
			if (fos != null) {
				fos.close();
			}
			if (inputStream != null) {
				inputStream.close();
			}
			// System.out.println("info:"+url+" download success");
			return saveDir + File.separator + fileName;
		} catch (Exception e) {
			e.printStackTrace();
		}
		return "";
 
	}
 
	/**
	 * 从输入流中获取字节数组
	 * 
	 * @param inputStream
	 * @return
	 * @throws IOException
	 */
	public static byte[] readInputStream(InputStream inputStream) throws IOException {
		byte[] buffer = new byte[1024];
		int len = 0;
		ByteArrayOutputStream bos = new ByteArrayOutputStream();
		while ((len = inputStream.read(buffer)) != -1) {
			bos.write(buffer, 0, len);
		}
		bos.close();
		return bos.toByteArray();
	}
```



- Optional使用方法

  `Optional.of()`对象不能为null,否则抛出*NullPointerException*      

  `Optional.ofNullable()`对象可以为null

  `orElse()`有值时返回值，没有值时返回默认值，==总是执行==，即使 `Optional` 中有值，`other` 也会被创建和传递。

  `orElseGet()`与上同理，不同的是当对象不为空是不会创建默认值对象（==惰性求值==）  => ==orElseGet(() -> new XX())==

  ```orElse适用于传进来一个明确的值，不需要执行方法体计算。orElseGet适用于传进来一个需要计算的方法体，返回计算后的值。```

---



### maven

- ##### maven进行文件构建时，resource目录下的资源可能在处理过程进行了不正确的转码，所以要使得文件可以正常构建


~~~tex
```maven-resources-plugin插件在Maven构建过程中负责复制项目中的资源文件到生成的目标目录，使得这些资源文件可以被应用程序访问和使用。这些资源文件包括但不限于属性文件、XML文件、配置文件等。```
~~~

- [ ] ##### 解决方法一、


​	```第一段配置声明：在src/main/resources目录下，后缀是.xlsx的文件不是资源文件，其它的资源文件需要被过滤。而第二段配置声明：同样在src/main/resources目录下，后缀是.xlsx的文件是资源文件，但是不会被过滤。```

```xml
	<resource>
	    <directory>src/main/resources</directory>
	    <excludes>
	        <exclude>**/*.xlsx</exclude>
	    </excludes>
	    <filtering>true</filtering>
	</resource>
	<resource>
	    <directory>src/main/resources</directory>
	    <includes>
	        <include>**/*.xlsx</include>
	    </includes>
	    <filtering>false</filtering>
	</resource>

```

- [ ] ##### 解决方法二、


```是在pom.xml中的maven-resources-plugin下，将不需要转码的文件扩展名填入nonFilteredFileExtensions```

```xml
	<plugin>
		<groupId>org.apache.maven.plugins</groupId>
		<artifactId>maven-resources-plugin</artifactId>
		<version>3.0.2</version>
		<configuration>
			<encoding>UTF-8</encoding>
			<nonFilteredFileExtensions>
				<nonFilteredFileExtension>xls</nonFilteredFileExtension>
				<nonFilteredFileExtension>xlsx</nonFilteredFileExtension>
			</nonFilteredFileExtensions>
		</configuration>
	</plugin>
```





# 杂项

### window端口

- #### window端口被占用

> 1、开始---->运行---->cmd，调出命令窗口。
> 2、输入命令：netstat -ano，列出所有端口的情况。在列表中我们观察被占用的端口，比如是49153，首先找到它。
> 3、查看被占用端口对应的PID，输入命令：netstat -aon|findstr “49153”，回车，记下最后一位数字，即PID，这里是1008。
> 4、继续输入tasklist|findstr “1008”，回车，查看是哪个进程或者程序占用了1008端口，结果是：svchost.exe。
> 5、或者是我们打开任务管理器也能根据PID找到进程。打开任务管理器切换到进程选项卡，默认是没有打开PID列的，如果看不到PID这一列





### GIT

- ##### git代理

设置代理

> \# Set HTTP proxy
>
> git config --global http.proxy http://127.0.0.1:7897
>
> 
>
> \# Set HTTPS proxy
>
> git config --global https.proxy http://127.0.0.1:7897

取消代理

> \# Unset HTTP proxy
>
> git config --global --unset http.proxy
>
> 
>
> \# Unset HTTPS proxy
>
> git config --global --unset https.proxy





### 前后端

前端发送formData

```ts
const formData = new FormData()
    formData.append('userInfo', JSON.stringify(modifyUserInfo.value))


    // 当前没有选择文件时，使用默认头像
    if (!currentFile.value) {
      const url = modifyUserInfo.value.headUrl.split('/fantasy-anime')[1]
      formData.append('headUrl', url)
      const {data} = axios.post(`/user/updateUserInfo`, formData, {requiresAuth: true})
      response.value = data
    }else {
      // 上传头像
      formData.append('file', currentFile.value)
      const {data} = await axios.post('/user/updateUserInfo', formData, {requiresAuth: true})
      response.value = data
    }
```

后端接收数据 ```需要使用consumes指定类型，接收参数使用@RequestPart接收，required设置属性是否未必要```

```java
@PostMapping(path = "/updateUserInfo",consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    public Result updateUserInfo(@RequestPart("userInfo") String userEntity,
                                 @RequestPart(value = "file", required = false) MultipartFile file,
                                 @RequestPart(value = "headUrl",required = false) String headUrl)
```

